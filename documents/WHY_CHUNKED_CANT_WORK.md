# ì™œ Transfer-Encoding: chunkedì™€ ì„¤ì •ìœ¼ë¡œëŠ” ì•ˆ ë˜ëŠ”ê°€?

## ğŸš« í•µì‹¬ ë¬¸ì œ: ì œí•œ ë ˆë²¨ ì°¨ì´

### **ì œí•œì´ ì ìš©ë˜ëŠ” ìœ„ì¹˜**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  í´ë¼ì´ì–¸íŠ¸ (ë¸Œë¼ìš°ì €)                    â”‚
â”‚  â†“ POST /api/upload (5GB body)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vercel Edge Network / nginx            â”‚  â† ğŸ”´ ì—¬ê¸°ì„œ 4.5MB ì²´í¬!
â”‚  - í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ë¶„ì„                    â”‚
â”‚  - body í¬ê¸° í™•ì¸                        â”‚
â”‚  - 4.5MB ì´ˆê³¼ â†’ ì¦‰ì‹œ ê±°ë¶€ (413)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ (í†µê³¼ ì•ˆ ë¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Next.js API Route                      â”‚  â† ì—¬ê¸°ê¹Œì§€ ë„ë‹¬ ë¶ˆê°€ëŠ¥
â”‚  - export const config                  â”‚
â”‚  - bodyParser: false                    â”‚
â”‚  - multipart.maxFileSize ì„¤ì •          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ê° ë°©ë²•ì´ ì•ˆ ë˜ëŠ” ì´ìœ 

### **1. Transfer-Encoding: chunked âŒ**

#### **ì´ë¡ :**
```http
POST /api/upload HTTP/1.1
Transfer-Encoding: chunked
Content-Type: multipart/form-data

1000\r\n
[1000 bytes data]\r\n
1000\r\n
[1000 bytes data]\r\n
...
0\r\n\r\n
```

#### **ë¬¸ì œì :**
1. âœ… HTTP í”„ë¡œí† ì½œ ë ˆë²¨ì—ì„œëŠ” ì²­í¬ë¡œ ì „ì†¡ë¨
2. âŒ **í•˜ì§€ë§Œ Edge NetworkëŠ” ìµœì¢… body í¬ê¸°ë¥¼ ëˆ„ì  ê³„ì‚°**
3. âŒ 4.5MB ì´ˆê³¼ ì‹œ ì¦‰ì‹œ ê±°ë¶€ (ì „ì²´ ì²­í¬ ìˆ˜ì‹  ì „)

**ì‹¤ì œ ë™ì‘:**
```
[Edge Network]
ì²­í¬ 1 ìˆ˜ì‹  (1MB) â†’ ëˆ„ì : 1MB âœ“
ì²­í¬ 2 ìˆ˜ì‹  (1MB) â†’ ëˆ„ì : 2MB âœ“
ì²­í¬ 3 ìˆ˜ì‹  (1MB) â†’ ëˆ„ì : 3MB âœ“
ì²­í¬ 4 ìˆ˜ì‹  (1MB) â†’ ëˆ„ì : 4MB âœ“
ì²­í¬ 5 ìˆ˜ì‹  (1MB) â†’ ëˆ„ì : 5MB âœ— âŒ ê±°ë¶€! (413 Request Entity Too Large)
```

---

### **2. multipart.maxFileSize ì„¤ì • âŒ**

#### **Next.js Pages Router (ì˜ˆì „ ë°©ì‹):**
```typescript
// pages/api/upload.ts
export const config = {
  api: {
    bodyParser: {
      sizeLimit: '500mb',  // âŒ ì´ê²ƒë„ ì•ˆ ë¨!
    },
  },
};
```

#### **ë¬¸ì œì :**
1. âŒ Next.js ì„¤ì •ì€ **ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨**ì—ì„œë§Œ ë™ì‘
2. âŒ Edge Network ì œí•œì€ **ê·¸ ì „ì—** ì ìš©ë¨
3. âŒ Next.js Route Handlerì— ë„ë‹¬í•˜ê¸° ì „ì— ê±°ë¶€ë¨

#### **App Router (í˜„ì¬ ë°©ì‹):**
```typescript
// app/api/upload/route.tsx
// export const configëŠ” App Routerì—ì„œ ë¬´ì‹œë¨!
export async function POST(request: Request) {
  // request.bodyë¥¼ ì½ìœ¼ë ¤ê³  í•´ë„ ì´ë¯¸ ê±°ë¶€ë¨
}
```

---

### **3. next.config.ts ì„¤ì • âŒ**

```typescript
// next.config.ts
const nextConfig = {
  experimental: {
    serverActions: {
      bodySizeLimit: '10gb',  // âŒ ì´ê²ƒë„ ì•ˆ ë¨!
    },
  },
};
```

#### **ë¬¸ì œì :**
1. âœ… Server Actionsì˜ body size limitì€ ë³€ê²½ë¨
2. âŒ **í•˜ì§€ë§Œ Edge Network ì œí•œì€ ë³„ê°œ**
3. âŒ Edge Networkì—ì„œ ë¨¼ì € ì²´í¬í•˜ë¯€ë¡œ ì˜ë¯¸ ì—†ìŒ

---

## ğŸ” Vercelì˜ ì‹¤ì œ ì œí•œ êµ¬ì¡°

### **3ë‹¨ê³„ ì²´í¬:**

```
1ë‹¨ê³„: [Vercel Edge Network]
       - nginx client_max_body_size
       - ì „ì—­ ì„¤ì •: 4.5MB
       - ë³€ê²½ ë¶ˆê°€ëŠ¥ âŒ

2ë‹¨ê³„: [Next.js Framework]
       - next.config.ts
       - Route Handler config
       - ë³€ê²½ ê°€ëŠ¥ (í•˜ì§€ë§Œ 1ë‹¨ê³„ì—ì„œ ì´ë¯¸ ë§‰í˜)

3ë‹¨ê³„: [Application Code]
       - bodyParser ì„¤ì •
       - multer ë“± ë¯¸ë“¤ì›¨ì–´
       - ë³€ê²½ ê°€ëŠ¥ (í•˜ì§€ë§Œ 1ë‹¨ê³„ì—ì„œ ì´ë¯¸ ë§‰í˜)
```

---

## âœ… ê·¸ë˜ì„œ ì²­í¬ ì—…ë¡œë“œê°€ í•„ìš”í•œ ì´ìœ 

### **í˜„ì¬ ë°©ì‹ (ìˆ˜ë™ ì²­í¬):**
```
[ë¸Œë¼ìš°ì €]
  â†“ POST /api/upload/init (JSON, ~200 bytes) â† Edge Network í†µê³¼ âœ“
  â†“ POST /api/upload/chunk (4MB)             â† Edge Network í†µê³¼ âœ“
  â†“ POST /api/upload/chunk (4MB)             â† Edge Network í†µê³¼ âœ“
  â†“ ...
  â†“ POST /api/upload/complete (JSON, ~100 bytes) â† Edge Network í†µê³¼ âœ“
```

**ê° ìš”ì²­ì´ 4.5MB ì´í•˜ì´ë¯€ë¡œ ëª¨ë‘ í†µê³¼!**

---

## ğŸ’¡ ë§Œì•½ ì„¤ì •ìœ¼ë¡œ ê°€ëŠ¥í•˜ë‹¤ë©´?

### **ê°€ëŠ¥í•œ ê²½ìš°:**
- âœ… **ìì²´ ì„œë²„** (nginx ì„¤ì • ë³€ê²½ ê°€ëŠ¥)
  ```nginx
  client_max_body_size 10g;  # nginx ì„¤ì • ë³€ê²½
  ```

- âœ… **í´ë¼ìš°ë“œ ì„œë²„** (EC2, GCP ë“±)
  ```nginx
  # /etc/nginx/nginx.conf
  http {
    client_max_body_size 10g;
  }
  ```

### **ë¶ˆê°€ëŠ¥í•œ ê²½ìš°:**
- âŒ **Vercel Edge Network** (ê´€ë¦¬í˜• ì„œë¹„ìŠ¤)
  - nginx ì„¤ì • ë³€ê²½ ë¶ˆê°€ëŠ¥
  - ì „ì—­ 4.5MB ì œí•œ ê³ ì •

---

## ğŸ“Š ë¹„êµí‘œ

| ë°©ë²• | Edge Network ì œí•œ | Next.js ì„¤ì • | ê²°ê³¼ |
|------|------------------|--------------|------|
| **Transfer-Encoding: chunked** | âŒ ì²´í¬ë¨ (ëˆ„ì  í¬ê¸°) | - | âŒ ì‹¤íŒ¨ |
| **multipart.maxFileSize** | âŒ ì²´í¬ë¨ | âœ… ì„¤ì • ê°€ëŠ¥ | âŒ ì‹¤íŒ¨ |
| **bodyParser.sizeLimit** | âŒ ì²´í¬ë¨ | âœ… ì„¤ì • ê°€ëŠ¥ | âŒ ì‹¤íŒ¨ |
| **Server Actions bodySizeLimit** | âŒ ì²´í¬ë¨ | âœ… ì„¤ì • ê°€ëŠ¥ | âŒ ì‹¤íŒ¨ |
| **ì²­í¬ ì—…ë¡œë“œ (í˜„ì¬ ë°©ì‹)** | âœ… ê° ìš”ì²­ < 4.5MB | - | âœ… **ì„±ê³µ!** |

---

## ğŸ¯ ê²°ë¡ 

### **ì™œ ì„¤ì •ìœ¼ë¡œ ì•ˆ ë˜ëŠ”ê°€?**

1. **ì œí•œ ë ˆë²¨ ì°¨ì´:**
   - Edge Network (nginx) â†’ **4.5MB** (ë³€ê²½ ë¶ˆê°€)
   - Next.js â†’ ì„¤ì • ê°€ëŠ¥í•˜ì§€ë§Œ ë„ë‹¬ ì „ì— ë§‰í˜

2. **ì²´í¬ ìˆœì„œ:**
   ```
   Edge Network ì²´í¬ â†’ Next.js ì„¤ì • â†’ Application ì½”ë“œ
        â†‘
   ì—¬ê¸°ì„œ ë§‰í˜!
   ```

3. **í•´ê²°ì±…:**
   - âœ… íŒŒì¼ì„ ìˆ˜ë™ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì—¬ëŸ¬ ìš”ì²­ìœ¼ë¡œ ì „ì†¡
   - âœ… ê° ìš”ì²­ì´ 4.5MB ì´í•˜ ìœ ì§€
   - âœ… í˜„ì¬ êµ¬í˜„ ë°©ì‹ì´ ìœ ì¼í•œ í•´ê²°ì±…

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Vercel Platform Limits](https://vercel.com/docs/platform/limits)
- [Next.js API Routes Configuration](https://nextjs.org/docs/api-routes/request-helpers)
- [nginx client_max_body_size](https://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size)






