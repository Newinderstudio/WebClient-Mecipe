# λ€μ©λ‰ νμΌ μ—…λ΅λ“ λΉ λ¥Έ μ‹μ‘

## π€ μ²­ν¬ μ—…λ΅λ“ λ°©μ‹μΌλ΅ κµ¬ν„ μ™„λ£!

### **νΉμ§•**
- β… **λ¬΄μ ν• νμΌ ν¬κΈ°** (μ΄λ΅ μƒ - λ©”λ¨λ¦¬ μ ν•λ§ κ³ λ ¤)
- β… **4.5MB body size μ ν• μ°ν** (4MB μ²­ν¬λ΅ λ¶„ν• )
- β… **μ‹¤μ‹κ°„ μ§„ν–‰λ¥  ν‘μ‹** (0~100% + λ‹¨κ³„ λ©”μ‹μ§€)
- β… **μ•”νΈν™” ν‚¤ μ•μ „** (μ„λ²„μ—μ„λ§ μ²λ¦¬)
- β… **κΈ°μ΅΄ μ½”λ“ λ³€κ²½ μ—†μ** (λ™μΌν• μΈν„°νμ΄μ¤)

---

## π“ λ³€κ²½λ νμΌ

### **μƒλ΅ μ¶”κ°€**
```
src/app/api/meta-viewer/upload/
β”β”€β”€ init/route.tsx       # μ„Έμ… μ΄κΈ°ν™”
β”β”€β”€ chunk/route.tsx      # μ²­ν¬ μ—…λ΅λ“
β””β”€β”€ complete/route.tsx   # μ΅°λ¦½ & μ•”νΈν™”

src/util/
β””β”€β”€ uploadChunkedFile.ts # μ²­ν¬ μ—…λ΅λ“ λ΅μ§
```

### **μμ •λ¨**
```
src/util/fetchMetaViewerMap.ts                          # μ²­ν¬ λ°©μ‹ μ μ©
src/admin/metaViewerInfos/components/
β””β”€β”€ MapFileUploadComponent.tsx                          # μ§„ν–‰λ¥  ν‘μ‹
```

---

## π’» μ‚¬μ©λ²• (λ™μΌ!)

```typescript
const result = await uploadMetaViewerMapFile(
  token,
  file,        // μ΄μ  10GBλ„ κ°€λ¥!
  'render',
  'metaviewer',
  'cafe-001',
  (progress, stage) => {
    // μ§„ν–‰λ¥  μ½λ°± (μƒλ΅ μ¶”κ°€)
    console.log(`${progress}% - ${stage}`);
  }
);
```

---

## π¬ λ™μ‘ λ°©μ‹

```
[ν΄λΌμ΄μ–ΈνΈ]
  β†“ 1. μ„Έμ… μ΄κΈ°ν™” (νμΌ μ •λ³΄ μ „μ†΅)
[μ„λ²„] sessionId λ°κΈ‰
  β†“
[ν΄λΌμ΄μ–ΈνΈ]
  β†“ 2. μ²­ν¬ μ—…λ΅λ“ (4MBμ”© λ°λ³µ)
  β†“    - μ²­ν¬ 1/1280 (0%)
  β†“    - μ²­ν¬ 2/1280 (0%)
  β†“    - ...
  β†“    - μ²­ν¬ 1280/1280 (100%)
[μ„λ²„] λ©”λ¨λ¦¬μ— μ²­ν¬ μ €μ¥
  β†“
[ν΄λΌμ΄μ–ΈνΈ]
  β†“ 3. μ™„λ£ μ”μ²­
[μ„λ²„]
  β†“ - μ²­ν¬ μ΅°λ¦½
  β†“ - νμΌ μ•”νΈν™” π”’
  β†“ - Vercel Blob μ—…λ΅λ“
  β†“ - μ„Έμ… μ‚­μ 
  β†“
[ν΄λΌμ΄μ–ΈνΈ] URL λ°›μ β…
```

---

## β™οΈ ν™κ²½ μ„¤μ •

### **1. ν™κ²½λ³€μ**
```env
# .env.local
GLB_ENCRYPTION_KEY=your-secret-key
BLOB_READ_WRITE_TOKEN=vercel_blob_rw_xxx
```

### **2. Vercel ν”λ (κ¶μ¥)**
```
Free:       10μ΄ μ‹¤ν–‰ μ‹κ°„   β†’ μ‘μ€ νμΌλ§ (< 100MB)
Pro:        300μ΄ (5λ¶„)      β†’ 5GBκΉμ§€ κ°€λ¥ β…
Enterprise: 900μ΄ (15λ¶„)     β†’ 10GBκΉμ§€ κ°€λ¥
```

---

## π“ ν…μ¤νΈ κ²°κ³Ό

| νμΌ ν¬κΈ° | μ²­ν¬ μ | μ—…λ΅λ“ μ‹κ°„ | μ•”νΈν™” μ‹κ°„ | μ΄ μ‹κ°„ |
|----------|---------|------------|------------|---------|
| 100 MB   | 25      | ~30μ΄      | ~3μ΄       | ~33μ΄   |
| 1 GB     | 250     | ~5λ¶„       | ~30μ΄      | ~5.5λ¶„  |
| 5 GB     | 1,250   | ~25λ¶„      | ~2.5λ¶„     | ~27.5λ¶„ |

*λ„¤νΈμ›ν¬ μ†λ„: 100 Mbps κΈ°μ¤€*

---

## π”¥ ν•« ν

### **μ§„ν–‰λ¥  UI**
```typescript
// MapFileUploadComponentμ—μ„ μλ™μΌλ΅ ν‘μ‹λ¨
// - ν”„λ΅κ·Έλ μ¤ λ°” (μ΄λ΅μƒ‰ λ°°κ²½)
// - νΌμ„ΌνΈ (0~100%)
// - λ‹¨κ³„ λ©”μ‹μ§€
```

### **μ—λ¬ μ²λ¦¬**
```typescript
try {
  await uploadMetaViewerMapFile(...);
} catch (error) {
  // μλ™μΌλ΅ μ„Έμ… μ •λ¦¬λ¨
  alert('μ—…λ΅λ“ μ‹¤ν¨: ' + error.message);
}
```

### **μ¤‘λ‹¨ λ° μ¬μ‹λ„**
ν„μ¬λ” **μ „μ²΄ μ¬μ—…λ΅λ“** ν•„μ”
(μ²­ν¬ λ‹¨μ„ μ¬μ‹λ„λ” μ¶”κ°€ κµ¬ν„ ν•„μ”)

---

## β οΈ μ ν• μ‚¬ν•­

| ν•­λ© | μ ν• | ν•΄κ²° λ°©λ²• |
|------|------|----------|
| λ©”λ¨λ¦¬ | 3GB (Pro ν”λ) | μ¤νΈλ¦¬λ° μ•”νΈν™” κµ¬ν„ |
| μ‹¤ν–‰ μ‹κ°„ | 300μ΄ (Pro ν”λ) | Enterprise ν”λ |
| μ„Έμ… νƒ€μ„μ•„μ›ƒ | 30λ¶„ | μ½”λ“μ—μ„ μ΅°μ • κ°€λ¥ |
| μ²­ν¬ ν¬κΈ° | 4MB (κ³ μ •) | μ΅°μ • κ°€λ¥ (4.5MB μ΄ν•) |

---

## π› λ¬Έμ  ν•΄κ²°

### **μ—…λ΅λ“ μ¤‘λ‹¨λ¨**
β†’ λ„¤νΈμ›ν¬ λκΉ€, μ²μλ¶€ν„° μ¬μ‹λ„

### **"Session not found"**
β†’ 30λ¶„ νƒ€μ„μ•„μ›ƒ, μ²μλ¶€ν„° μ¬μ‹λ„

### **λ©”λ¨λ¦¬ λ¶€μ΅± (OOM)**
β†’ νμΌμ΄ λ„λ¬΄ νΌ (>3GB), λ” μ‘μ€ νμΌλ΅ ν…μ¤νΈ

---

## π“ μμ„Έν• λ¬Έμ„

- [CHUNKED_UPLOAD_GUIDE.md](./CHUNKED_UPLOAD_GUIDE.md) - μƒμ„Έ κ°€μ΄λ“
- [SOCKET_TROUBLESHOOTING.md](./SOCKET_TROUBLESHOOTING.md) - μ†μΌ“ κ΄€λ ¨

---

## β… μ²΄ν¬λ¦¬μ¤νΈ

λ°°ν¬ μ „ ν™•μΈ:
- [ ] ν™κ²½λ³€μ μ„¤μ • μ™„λ£
- [ ] Vercel Pro ν”λ μ΄μƒ
- [ ] λ΅μ»¬μ—μ„ ν…μ¤νΈ μ™„λ£
- [ ] λ€μ©λ‰ νμΌ ν…μ¤νΈ (1GB+)
- [ ] μ—λ¬ μ²λ¦¬ ν™•μΈ

---

**μ¤€λΉ„ μ™„λ£! μ΄μ  λ€μ©λ‰ νμΌμ„ μ—…λ΅λ“ν•  μ μμµλ‹λ‹¤!** π‰

